---
title: "認証"
description: "MealPlan AI APIの認証方法"
---

## 認証について

MealPlan AI APIは、すべてのリクエストに認証を要求します。APIキーまたはOAuth 2.0トークンを使用して認証できます。

<CardGroup cols={2}>
  <Card title="APIキー認証" icon="key">
    シンプルで迅速な認証方法。個人開発やサーバーサイドアプリケーションに最適
  </Card>
  <Card title="OAuth 2.0" icon="shield-check">
    より安全な認証方法。ユーザー代理でアクセスする場合に推奨
  </Card>
</CardGroup>

## APIキー認証

### APIキーの取得

1. [ダッシュボード](https://app.mealplan-ai.com)にログイン
2. 「Settings」→「API Keys」に移動
3. 「Create New API Key」をクリック
4. キーに名前を付けて作成

<Warning>
  APIキーは秘密情報です。公開リポジトリにコミットしたり、クライアントサイドのコードに含めたりしないでください。
</Warning>

### APIキーの使用

APIキーは、`Authorization`ヘッダーにBearer トークンとして含めます：

<CodeGroup>
```bash cURL
curl -X GET https://api.mealplan-ai.com/v1/profiles \
  -H "Authorization: Bearer YOUR_API_KEY"
```

```javascript JavaScript
const response = await fetch('https://api.mealplan-ai.com/v1/profiles', {
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY'
  }
});
```

```python Python
import requests

headers = {
    'Authorization': 'Bearer YOUR_API_KEY'
}
response = requests.get('https://api.mealplan-ai.com/v1/profiles', headers=headers)
```

```ruby Ruby
require 'net/http'

uri = URI('https://api.mealplan-ai.com/v1/profiles')
request = Net::HTTP::Get.new(uri)
request['Authorization'] = 'Bearer YOUR_API_KEY'

response = Net::HTTP.start(uri.hostname, uri.port, use_ssl: true) do |http|
  http.request(request)
end
```
</CodeGroup>

### 環境変数の使用

APIキーは環境変数に保存することをお勧めします：

<CodeGroup>
```bash .env
MEALPLAN_API_KEY=your_api_key_here
```

```javascript JavaScript
// .envファイルから読み込み
require('dotenv').config();

const apiKey = process.env.MEALPLAN_API_KEY;

const response = await fetch('https://api.mealplan-ai.com/v1/profiles', {
  headers: {
    'Authorization': `Bearer ${apiKey}`
  }
});
```

```python Python
import os
from dotenv import load_dotenv

load_dotenv()
api_key = os.getenv('MEALPLAN_API_KEY')

headers = {
    'Authorization': f'Bearer {api_key}'
}
```
</CodeGroup>

## OAuth 2.0認証

OAuth 2.0は、ユーザーの代わりにAPIにアクセスする必要がある場合に使用します。

### サポートされるフロー

<Tabs>
  <Tab title="Authorization Code Flow">
    **推奨**: Webアプリケーション向け
    
    最も安全なフローで、クライアントシークレットをサーバーサイドで保護できます。
    
    <Steps>
      <Step title="認可リクエスト">
        ユーザーをMealPlan AIの認可ページにリダイレクト
        
        ```
        https://app.mealplan-ai.com/oauth/authorize?
          client_id=YOUR_CLIENT_ID&
          redirect_uri=YOUR_REDIRECT_URI&
          response_type=code&
          scope=meal_plans:read meal_plans:write profiles:read&
          state=RANDOM_STATE_STRING
        ```
      </Step>
      
      <Step title="認可コードの取得">
        ユーザーが承認すると、認可コードがリダイレクトURIに返されます
        
        ```
        https://your-app.com/callback?code=AUTH_CODE&state=RANDOM_STATE_STRING
        ```
      </Step>
      
      <Step title="アクセストークンの取得">
        認可コードをアクセストークンに交換
        
        ```bash
        curl -X POST https://app.mealplan-ai.com/oauth/token \
          -H "Content-Type: application/x-www-form-urlencoded" \
          -d "grant_type=authorization_code" \
          -d "code=AUTH_CODE" \
          -d "client_id=YOUR_CLIENT_ID" \
          -d "client_secret=YOUR_CLIENT_SECRET" \
          -d "redirect_uri=YOUR_REDIRECT_URI"
        ```
        
        レスポンス:
        ```json
        {
          "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
          "token_type": "Bearer",
          "expires_in": 3600,
          "refresh_token": "def50200...",
          "scope": "meal_plans:read meal_plans:write profiles:read"
        }
        ```
      </Step>
      
      <Step title="APIリクエスト">
        取得したアクセストークンを使用してAPIにアクセス
        
        ```bash
        curl -X GET https://api.mealplan-ai.com/v1/meal-plans \
          -H "Authorization: Bearer ACCESS_TOKEN"
        ```
      </Step>
    </Steps>
  </Tab>
  
  <Tab title="Client Credentials Flow">
    **サーバー間通信向け**
    
    ユーザーコンテキストなしで、アプリケーション自体の権限でAPIにアクセスします。
    
    ```bash
    curl -X POST https://app.mealplan-ai.com/oauth/token \
      -H "Content-Type: application/x-www-form-urlencoded" \
      -d "grant_type=client_credentials" \
      -d "client_id=YOUR_CLIENT_ID" \
      -d "client_secret=YOUR_CLIENT_SECRET" \
      -d "scope=meal_plans:read profiles:read"
    ```
    
    レスポンス:
    ```json
    {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600,
      "scope": "meal_plans:read profiles:read"
    }
    ```
  </Tab>
  
  <Tab title="Refresh Token Flow">
    **トークンの更新**
    
    アクセストークンの有効期限が切れた場合、リフレッシュトークンを使用して新しいアクセストークンを取得します。
    
    ```bash
    curl -X POST https://app.mealplan-ai.com/oauth/token \
      -H "Content-Type: application/x-www-form-urlencoded" \
      -d "grant_type=refresh_token" \
      -d "refresh_token=YOUR_REFRESH_TOKEN" \
      -d "client_id=YOUR_CLIENT_ID" \
      -d "client_secret=YOUR_CLIENT_SECRET"
    ```
    
    レスポンス:
    ```json
    {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600,
      "refresh_token": "def50200...",
      "scope": "meal_plans:read meal_plans:write profiles:read"
    }
    ```
  </Tab>
</Tabs>

### OAuth 2.0スコープ

アクセス権限を細かく制御するためのスコープ：

| スコープ | 説明 |
|---------|------|
| `meal_plans:read` | 献立の読み取り |
| `meal_plans:write` | 献立の作成・更新・削除 |
| `recipes:read` | レシピの読み取り |
| `recipes:write` | レシピのお気に入り管理 |
| `shopping:read` | 買い物リストの読み取り |
| `shopping:write` | 買い物リストの作成・更新 |
| `profiles:read` | プロフィールの読み取り |
| `profiles:write` | プロフィールの作成・更新 |
| `webhooks:read` | Webhookの読み取り |
| `webhooks:write` | Webhookの作成・更新・削除 |

<Tip>
  必要最小限のスコープのみをリクエストすることをお勧めします。これにより、セキュリティが向上し、ユーザーの信頼を得やすくなります。
</Tip>

## トークンの管理

### トークンの有効期限

- **アクセストークン**: 1時間
- **リフレッシュトークン**: 30日間
- **APIキー**: 無期限（手動で無効化するまで）

### トークンの無効化

<Tabs>
  <Tab title="APIキー">
    [ダッシュボード](https://app.mealplan-ai.com/settings/api-keys)から手動で無効化できます。
  </Tab>
  
  <Tab title="OAuth トークン">
    ```bash
    curl -X POST https://app.mealplan-ai.com/oauth/revoke \
      -H "Content-Type: application/x-www-form-urlencoded" \
      -d "token=ACCESS_TOKEN" \
      -d "client_id=YOUR_CLIENT_ID" \
      -d "client_secret=YOUR_CLIENT_SECRET"
    ```
  </Tab>
</Tabs>

## セキュリティのベストプラクティス

<AccordionGroup>
  <Accordion title="APIキーを安全に保管する">
    - 環境変数に保存
    - バージョン管理システムにコミットしない
    - `.gitignore`に`.env`ファイルを追加
    - クライアントサイドのコードに含めない
  </Accordion>
  
  <Accordion title="HTTPS を使用する">
    すべてのAPIリクエストはHTTPS経由で送信してください。HTTPでの通信はサポートされていません。
  </Accordion>
  
  <Accordion title="トークンをローテーションする">
    定期的にAPIキーを更新し、古いキーを無効化してください。特に、キーが漏洩した可能性がある場合は即座に無効化してください。
  </Accordion>
  
  <Accordion title="最小権限の原則">
    必要最小限のスコープのみを要求してください。すべての権限を要求するのではなく、実際に必要な権限のみを指定します。
  </Accordion>
  
  <Accordion title="トークンの有効期限を監視する">
    アクセストークンの有効期限を監視し、期限切れ前にリフレッシュトークンを使用して更新してください。
  </Accordion>
</AccordionGroup>

## 認証エラー

### 401 Unauthorized

認証情報が無効または欠落している場合に返されます。

```json
{
  "success": false,
  "error": {
    "code": "unauthorized",
    "message": "認証が必要です",
    "details": {
      "reason": "invalid_token",
      "description": "提供されたトークンが無効です"
    }
  }
}
```

**一般的な原因:**
- APIキーが間違っている
- トークンの有効期限が切れている
- `Authorization`ヘッダーの形式が間違っている

### 403 Forbidden

認証は成功したが、リソースへのアクセス権限がない場合に返されます。

```json
{
  "success": false,
  "error": {
    "code": "forbidden",
    "message": "このリソースへのアクセス権限がありません",
    "details": {
      "required_scope": "meal_plans:write",
      "current_scopes": ["meal_plans:read"]
    }
  }
}
```

## 実装例

### Node.js (Express)

```javascript
const express = require('express');
const axios = require('axios');

const app = express();
const MEALPLAN_API_KEY = process.env.MEALPLAN_API_KEY;

app.get('/meal-plans', async (req, res) => {
  try {
    const response = await axios.get(
      'https://api.mealplan-ai.com/v1/meal-plans',
      {
        headers: {
          'Authorization': `Bearer ${MEALPLAN_API_KEY}`
        }
      }
    );
    res.json(response.data);
  } catch (error) {
    if (error.response?.status === 401) {
      res.status(401).json({ error: '認証に失敗しました' });
    } else {
      res.status(500).json({ error: 'サーバーエラー' });
    }
  }
});

app.listen(3000);
```

### Python (Flask)

```python
from flask import Flask, jsonify
import requests
import os

app = Flask(__name__)
MEALPLAN_API_KEY = os.getenv('MEALPLAN_API_KEY')

@app.route('/meal-plans')
def get_meal_plans():
    try:
        headers = {
            'Authorization': f'Bearer {MEALPLAN_API_KEY}'
        }
        response = requests.get(
            'https://api.mealplan-ai.com/v1/meal-plans',
            headers=headers
        )
        response.raise_for_status()
        return jsonify(response.json())
    except requests.exceptions.HTTPError as e:
        if e.response.status_code == 401:
            return jsonify({'error': '認証に失敗しました'}), 401
        return jsonify({'error': 'サーバーエラー'}), 500

if __name__ == '__main__':
    app.run()
```

## 次のステップ

<CardGroup cols={2}>
  <Card title="レート制限" icon="gauge" href="/developer/rate-limits">
    API使用量の制限について学ぶ
  </Card>
  <Card title="エラーハンドリング" icon="triangle-exclamation" href="/developer/error-handling">
    エラーの処理方法を理解する
  </Card>
  <Card title="献立API" icon="utensils" href="/api-reference/meal-plans/generate">
    献立生成APIを使い始める
  </Card>
  <Card title="ベストプラクティス" icon="star" href="/developer/best-practices">
    API使用のベストプラクティス
  </Card>
</CardGroup>

<Note>
  **サポートが必要ですか？** 
  
  認証に関する問題がある場合は、[support@mealplan-ai.com](mailto:support@mealplan-ai.com)までお問い合わせください。
</Note>